# connectors/docker-compose.yml
#
# Runs the Chat Proxy service.
# meMCP itself is NOT included here — it runs independently.
#
# Setup:
#   cp .env.example .env
#   # fill in GROQ_API_KEY and PROXY_SECRET
#   docker compose up
#
# All connection/path settings come from config.yaml (chat: section).
# Secrets (GROQ_API_KEY, PROXY_SECRET) come from .env.
# The two optional env var overrides (MEMCP_URL, PROXY_DB_PATH) are kept
# here for Docker-specific paths that differ from local-dev config.

services:
  proxy:
    build: ./proxy
    container_name: memcp-chat-proxy
    restart: unless-stopped
    ports:
      - "8001:8001"
    env_file:
      - .env
    volumes:
      - proxy_data:/data
      - ../config.yaml:/config/config.yaml:ro
    environment:
      - CONFIG_PATH=/config/config.yaml
      # Docker-specific overrides — paths differ from local-dev config.yaml values
      - MEMCP_URL=${MEMCP_URL:-http://host.docker.internal:8000}
      - PROXY_DB_PATH=/data/proxy.db
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8001/health"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  proxy_data:
